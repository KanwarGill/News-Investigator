{% extends "base.html" %}
{% block content %}
<h1>Twitter Crawl Results</h1>
<div class="twitter-table-container">
    <div class="btn-group">
      <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
        Export Table Data <span class="caret"></span>
      </button>
      <ul class="dropdown-menu" role="menu">
        <li><a id="btnExportTableXML" href="#">As XML</a></li>
      </ul>
    </div>
    <div class="btn btn-primary custombtn" href="_blank" id="btnTweetsGraph">
          View Tweets Graph
    </div>
    <div>
        Tweets Graph appears at bottom of page (scroll down)
    </div>
    <table id="twitter-table"></table>
    <canvas id="barChart" width="600" height="400"></canvas>
</div>
<script type="text/javascript" src="/static/js/charts.js"></script>
<script>
    tweets_id = 0;

    function showTweets(id) {
        $('.tweets_' + id).toggle(function(){
            if($(this).css('display')=='none'){
              //change the button label to be 'Show'
              $(this).closest('td').find('a').html('Show Tweets');
            }else{
              //change the button label to be 'Hide'
              $(this).closest('td').find('a').html('Hide Tweets');
            }
        });
    }

    function tweetsFormatter(value) {
        if (value != '') {
            tweets_id++;
            return "<a href='#' onClick='showTweets(" + tweets_id + ");return false;'>Show Tweets</a><div style='display:none;' class='tweets_" + tweets_id + "'>" + value + "</div>";
        } else {
            return 'None found';
        }
    }
    
    // Generate the results table using Bootstrap Table
    $(function () {

      //console.log($("table tbody tr").html())


        $('#twitter-table').bootstrapTable({
            method: 'get',
            url: '/get_tweets',
            cache: false,
            height: 500,
            striped: true,
            pagination: true,
            pageSize: 50,
            pageList: [10, 25, 50, 100, 200],
            search: true,
            showColumns: true,
            showRefresh: true,
            minimumCountColumns: 2,
            clickToSelect: true,
            columns: [{
                field: 'keyword',
                title: 'Keyword',
                align: 'middle',
                valign: 'left',
                sortable: true
            }, {
                field: 'tweets',
                title: 'No. of tweets',
                align: 'middle',
                valign: 'left',
				width: '100',
                sortable: true
            }, {
        		field: 'tweets text',
        		title: 'Tweets',
        		align: 'middle',
        		valign: 'left',
        		width: '1000',
        		sortable: true,
        		formatter: 'tweetsFormatter'
			}]
        });

        $("#btnExportTableXML").click(function () {
            $('#twitter-table').tableExport({type:'xml',escape:'false'});
        });

        $("#btnTweetsGraph").click(function(){
            
            $.get("/get_tweets2", function(data) {
                var barData = {
                labels: data.keyword,
                datasets: [
                    {
                        label: "My First dataset",
                        fillColor: "rgba(151,187,205,0.5)",
                        strokeColor: "rgba(151,187,205,0.8)",
                        highlightFill: "rgba(151,187,205,0.75)",
                        highlightStroke: "rgba(151,187,205,1)",
                        data: data.count
                    }
                ]
            };


          var options = {
            scaleBeginAtZero : true
          }

          var tweets = document.getElementById("barChart").getContext("2d");
          new Chart(tweets).Bar(barData, options);
            });

        });
    });
</script>
<script src="/static/js/main.js"></script>
<script src="/static/js/chart.js"></script>
{% endblock %}